<!DOCTYPE html>
<html dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>ğŸŒ™ Moon Chat Rooms</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.5.1/socket.io.js"></script>
    <style>
        :root {
            --primary: #5865F2;
            --secondary: #2F3136;
            --background: #1a1a2e;
        }

        body {
            margin: 0;
            font-family: 'Cairo', sans-serif;
            background: linear-gradient(45deg, var(--background), #16213e);
            color: white;
            height: 100vh;
        }

        .container {
            display: grid;
            grid-template-columns: 250px 1fr;
            height: 100vh;
        }

        .sidebar {
            background: rgba(47, 49, 54, 0.8);
            padding: 20px;
            border-right: 1px solid rgba(255,255,255,0.1);
        }

        .main-content {
            display: grid;
            grid-template-rows: auto 1fr auto;
        }

        .room {
            background: rgba(255,255,255,0.05);
            margin: 10px 0;
            padding: 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: 0.3s;
        }

        .room:hover {
            background: rgba(255,255,255,0.1);
        }

        .chat-container {
            height: calc(100vh - 140px);
            display: flex;
            flex-direction: column;
        }

        .messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        .message {
            background: rgba(255,255,255,0.05);
            padding: 10px;
            margin: 5px 0;
            border-radius: 8px;
        }

        .input-area {
            padding: 20px;
            background: rgba(47, 49, 54, 0.8);
        }

        .chat-input {
            width: 100%;
            padding: 12px;

border: none;
            border-radius: 5px;
            background: rgba(255,255,255,0.1);
            color: white;
        }

        .controls {
            display: flex;
            gap: 10px;
            padding: 10px;
            background: rgba(47, 49, 54, 0.8);
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            background: var(--primary);
            color: white;
            transition: 0.3s;
        }

        .btn:hover {
            opacity: 0.9;
        }

        .voice-controls {
            display: flex;
            gap: 10px;
            padding: 10px;
            background: rgba(47, 49, 54, 0.8);
        }

        .mic-btn {
            background: #43b581;
        }

        .mic-btn.active {
            background: #ed4245;
        }

        .participants {
            padding: 10px;
            background: rgba(47, 49, 54, 0.8);
        }

        .participant {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 5px;
        }

        .speaking {
            border: 2px solid #43b581;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <h2>Ø§Ù„ØºØ±Ù Ø§Ù„Ù…ØªØ§Ø­Ø©</h2>
            <div id="rooms-list"></div>
            <button class="btn" onclick="createRoom()">Ø¥Ù†Ø´Ø§Ø¡ ØºØ±ÙØ© Ø¬Ø¯ÙŠØ¯Ø©</button>
        </div>
        
        <div class="main-content">
            <div class="controls">
                <h2 id="current-room">Ø§Ø®ØªØ± ØºØ±ÙØ© Ù„Ù„Ø§Ù†Ø¶Ù…Ø§Ù…</h2>
            </div>
            
            <div class="chat-container">
                <div class="messages" id="messages"></div>
                <div class="participants" id="participants"></div>
                
                <div class="voice-controls">
                    <button class="btn mic-btn" id="mic-btn" onclick="toggleMic()">
â€                        ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ø§ÙŠÙƒ

</button>
                    <button class="btn" onclick="leaveRoom()">Ù…ØºØ§Ø¯Ø±Ø©</button>
                </div>
                
                <div class="input-area">
                    <input type="text" class="chat-input" id="message-input" 
                           placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§..." onkeypress="handleKeyPress(event)">
                </div>
            </div>
        </div>
    </div>

    <script>
        // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§ØªØµØ§Ù„ Socket.IO
        const socket = io('https://your-server.com');
        let currentRoom = null;
        let stream = null;
        let isMicOn = false;

        // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØºØ±Ù
        function createRoom() {
            const roomName = prompt('Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„ØºØ±ÙØ©:');
            if (roomName) {
                socket.emit('create-room', roomName);
            }
        }

        function joinRoom(roomId) {
            if (currentRoom) {
                leaveRoom();
            }
            currentRoom = roomId;
            socket.emit('join-room', roomId);
            document.getElementById('current-room').textContent = `ØºØ±ÙØ©: ${roomId}`;
        }

        function leaveRoom() {
            if (currentRoom) {
                socket.emit('leave-room', currentRoom);
                currentRoom = null;
                document.getElementById('current-room').textContent = 'Ø§Ø®ØªØ± ØºØ±ÙØ© Ù„Ù„Ø§Ù†Ø¶Ù…Ø§Ù…';
            }
        }

        // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
        function sendMessage() {
            const input = document.getElementById('message-input');
            const message = input.value.trim();
            
            if (message && currentRoom) {
                socket.emit('chat-message', {
                    room: currentRoom,
                    message: message
                });
                input.value = '';
            }
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØµÙˆØª

async function toggleMic() {
            const micBtn = document.getElementById('mic-btn');
            
            if (!isMicOn) {
                try {
                    stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    socket.emit('start-stream', currentRoom);
                    micBtn.textContent = 'Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ø§ÙŠÙƒ';
                    micBtn.classList.add('active');
                    isMicOn = true;
                } catch (err) {
                    console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù…Ø§ÙŠÙƒ:', err);
                }
            } else {
                if (stream) {
                    stream.getTracks().forEach(track => track.stop());
                }
                socket.emit('stop-stream', currentRoom);
                micBtn.textContent = 'ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ø§ÙŠÙƒ';
                micBtn.classList.remove('active');
                isMicOn = false;
            }
        }

        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø£Ø­Ø¯Ø§Ø« Socket
        socket.on('room-created', (roomId) => {
            updateRoomsList();
        });

        socket.on('user-joined', (userId) => {
            updateParticipants();
        });

        socket.on('user-left', (userId) => {
            updateParticipants();
        });

        socket.on('chat-message', (data) => {
            const messagesDiv = document.getElementById('messages');
            const messageElement = document.createElement('div');
            messageElement.className = 'message';
            messageElement.textContent = `${data.user}: ${data.message}`;
            messagesDiv.appendChild(messageElement);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        });

        function updateRoomsList() {
            socket.emit('get-rooms', (rooms) => {
                const roomsList = document.getElementById('rooms-list');
                roomsList.innerHTML = '';
                rooms.forEach(room => {
                    const roomElement = document.createElement('div');

                    roomElement.className = 'room';
                    roomElement.textContent = room.name;
                    roomElement.onclick = () => joinRoom(room.id);
                    roomsList.appendChild(roomElement);
                });
            });
        }

        function updateParticipants() {
            socket.emit('get-participants', currentRoom, (participants) => {
                const participantsDiv = document.getElementById('participants');
                participantsDiv.innerHTML = '';
                participants.forEach(participant => {
                    const participantElement = document.createElement('div');
                    participantElement.className = 'participant';
                    if (participant.speaking) {
                        participantElement.classList.add('speaking');
                    }
                    participantElement.textContent = participant.name;
                    participantsDiv.appendChild(participantElement);
                });
            });
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
        updateRoomsList();
    </script>
</body>
</html>
