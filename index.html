<!DOCTYPE html>
<html dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Moon Music | بحث موسيقى</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Cairo', sans-serif;
        }

        body {
            background: #0f0f1a;
            color: white;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        .search-box {
            width: 100%;
            padding: 15px;
            background: #1a1a2e;
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 16px;
            margin-bottom: 20px;
        }

        .platforms {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .platform-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s;
        }

        .spotify-btn {
            background: #1DB954;
        }

        .youtube-btn {
            background: #FF0000;
        }

        .song-item {
            background: #1a1a2e;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .song-img {
            width: 80px;
            height: 80px;
            border-radius: 5px;
            object-fit: cover;
        }

        .song-info {
            flex: 1;
        }

        .song-title {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .song-artist {

color: #888;
            font-size: 14px;
        }

        .play-btn {
            background: #1DB954;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            transition: 0.3s;
        }

        .play-btn:hover {
            opacity: 0.9;
        }

        .loading {
            text-align: center;
            padding: 20px;
        }

        .error {
            color: #ff4444;
            text-align: center;
            padding: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <input type="text" class="search-box" placeholder="ابحث عن الموسيقى..." id="searchInput">
        
        <div class="platforms">
            <button class="platform-btn spotify-btn" onclick="setPlatform('spotify')">Spotify</button>
            <button class="platform-btn youtube-btn" onclick="setPlatform('youtube')">YouTube</button>
        </div>

        <div id="results"></div>
    </div>

    <script>
        // API Keys
        const SPOTIFY_CLIENT_ID = 'f2e4e9f5b11040708f3f7185d5d8c37c';
        const SPOTIFY_CLIENT_SECRET = '6ad3b1f7c2934d65b95dcef4eaa46978';
        const YOUTUBE_API_KEY = 'AIzaSyB4G1FgF-UJ2_RtG1z0LuhHj1G7_HxqR2s';

        let currentPlatform = 'spotify';
        let searchTimeout;
        let spotifyToken = '';

        // Get Spotify Token
        async function getSpotifyToken() {
            try {
                const response = await fetch('https://accounts.spotify.com/api/token', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                        'Authorization': 'Basic ' + btoa(SPOTIFY_CLIENT_ID + ':' + SPOTIFY_CLIENT_SECRET)
                    },
                    body: 'grant_type=client_credentials'
                });
                const data = await response.json();

return data.access_token;
            } catch (error) {
                console.error('Error getting Spotify token:', error);
                throw error;
            }
        }

        // Search Spotify
        async function searchSpotify(query) {
            try {
                if (!spotifyToken) {
                    spotifyToken = await getSpotifyToken();
                }
                
                const response = await fetch(
                    `https://api.spotify.com/v1/search?q=${query}&type=track&limit=10`,
                    {
                        headers: {
                            'Authorization': `Bearer ${spotifyToken}`
                        }
                    }
                );
                
                if (response.status === 401) {
                    // Token expired, get new token
                    spotifyToken = await getSpotifyToken();
                    return searchSpotify(query);
                }
                
                const data = await response.json();
                return data.tracks.items;
            } catch (error) {
                console.error('Error searching Spotify:', error);
                throw error;
            }
        }

        // Search YouTube
        async function searchYouTube(query) {
            try {
                const response = await fetch(
                    `https://www.googleapis.com/youtube/v3/search?part=snippet&q=${query}&type=video&key=${YOUTUBE_API_KEY}&maxResults=10`
                );
                const data = await response.json();
                return data.items;
            } catch (error) {
                console.error('Error searching YouTube:', error);
                throw error;
            }
        }

        // Display Results
        function displayResults(items, platform) {
            const resultsDiv = document.getElementById('results');
            
            if (items.length === 0) {

resultsDiv.innerHTML = '<div class="error">لم يتم العثور على نتائج</div>';
                return;
            }

            if (platform === 'spotify') {
                resultsDiv.innerHTML = items.map(item => `
                    <div class="song-item">
                        <img src="${item.album.images[0].url}" class="song-img" alt="${item.name}">
                        <div class="song-info">
                            <div class="song-title">${item.name}</div>
                            <div class="song-artist">${item.artists[0].name}</div>
                        </div>
                        <button class="play-btn" onclick="window.open('${item.external_urls.spotify}', '_blank')">
                            تشغيل
                        </button>
                    </div>
                `).join('');
            } else {
                resultsDiv.innerHTML = items.map(item => `
                    <div class="song-item">
                        <img src="${item.snippet.thumbnails.medium.url}" class="song-img" alt="${item.snippet.title}">
                        <div class="song-info">
                            <div class="song-title">${item.snippet.title}</div>
                            <div class="song-artist">${item.snippet.channelTitle}</div>
                        </div>
                        <button class="play-btn" onclick="window.open('https://www.youtube.com/watch?v=${item.id.videoId}', '_blank')">
                            مشاهدة
                        </button>
                    </div>
                `).join('');
            }
        }

        // Set Platform
        function setPlatform(platform) {
            currentPlatform = platform;
            const searchInput = document.getElementById('searchInput');
            if (searchInput.value.length > 2) {
                performSearch(searchInput.value);
            }
        }

        // Perform Search
        async function performSearch(query) {

            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<div class="loading">جاري البحث...</div>';

            try {
                let results;
                if (currentPlatform === 'spotify') {
                    results = await searchSpotify(query);
                } else {
                    results = await searchYouTube(query);
                }
                displayResults(results, currentPlatform);
            } catch (error) {
                resultsDiv.innerHTML = '<div class="error">حدث خطأ في البحث</div>';
            }
        }

        // Search Input Event Listener
        document.getElementById('searchInput').addEventListener('input', (e) => {
            clearTimeout(searchTimeout);
            if (e.target.value.length > 2) {
                searchTimeout = setTimeout(() => performSearch(e.target.value), 500);
            }
        });

        // Initialize Spotify Token
        getSpotifyToken().then(token => {
            spotifyToken = token;
        }).catch(error => {
            console.error('Error initializing Spotify token:', error);
        });
    </script>
</body>
</html>
