<!DOCTYPE html>
<html dir="rtl">
<head>
<title>Moon Voice | Ø¯Ø±Ø¯Ø´Ø© ØµÙˆØªÙŠØ©</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
â€/* ... Ø§Ù„Ø³ØªØ§ÙŠÙ„ Ø§Ù„Ø³Ø§Ø¨Ù‚ ... */

â€/* Ø¥Ø¶Ø§ÙØ© Ø³ØªØ§ÙŠÙ„ Ø¬Ø¯ÙŠØ¯ */
.modal {
position: fixed;
top: 0;
left: 0;
right: 0;
bottom: 0;
background: rgba(0,0,0,0.8);
display: flex;
justify-content: center;
align-items: center;
z-index: 1000;
}

.modal-content {
background: white;
padding: 2rem;
border-radius: 15px;
width: 90%;
max-width: 400px;
}

.share-screen-btn {
background: #10b981;
color: white;
padding: 0.8rem;
border-radius: 50%;
border: none;
cursor: pointer;
margin-left: 1rem;
font-size: 1.2rem;
}

.participants-grid {
display: grid;
grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
gap: 1rem;
margin-top: 1rem;
}

.participant-card {
background: #f3f4f6;
padding: 1rem;
border-radius: 12px;
text-align: center;
}

.participant-avatar {
width: 60px;
height: 60px;
border-radius: 50%;
background: var(--primary);
color: white;
display: flex;
align-items: center;
justify-content: center;
margin: 0 auto 1rem;
font-size: 1.5rem;
}

.room-status {
background: #fef3c7;
color: #92400e;
padding: 0.5rem;
border-radius: 8px;
margin: 1rem 0;
text-align: center;
}
</style>
</head>
<body>

â€<!-- Ù…ÙˆØ¯Ø§Ù„ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… -->
<div class="modal" id="nameModal">
<div class="modal-content">
<h2>Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ</h2>
<input type="text" id="userName" placeholder="Ø§Ø³Ù…Ùƒ Ù‡Ù†Ø§" style="width: 100%; margin: 1rem 0;">
<button class="btn btn-primary" onclick="setUserName()">ØªÙ…</button>
</div>
</div>

<div class="app-container">
â€<!-- ... Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„Ø³Ø§Ø¨Ù‚ ... -->

<div class="controls">
<button class="mic-btn" id="micBtn">ğŸ¤</button>
<button class="share-screen-btn" id="screenBtn">ğŸ–¥ï¸</button>
</div>

<div class="room-status" id="roomStatus"></div>

<div class="participants-grid" id="participantsList">
â€<!-- Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ† Ù‡Ù†Ø§ -->
</div>

â€<!-- ... Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø¹Ù†Ø§ØµØ± ... -->
</div>

<script>
let localStream;
let screenStream;
let peerConnections = {};

let userName = '';
let participants = new Set();
const MAX_PARTICIPANTS = 4;

// Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§Ø³Ù… Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
window.onload = () => {
document.getElementById('nameModal').style.display = 'flex';
};

// ØªØ¹ÙŠÙŠÙ† Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
function setUserName() {
const nameInput = document.getElementById('userName');
if (nameInput.value.trim()) {
userName = nameInput.value.trim();
document.getElementById('nameModal').style.display = 'none';
updateParticipants();
}
}

// ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ†
function updateParticipants() {
const list = document.getElementById('participantsList');
list.innerHTML = '';

participants.forEach(name => {
list.innerHTML += `
<div class="participant-card">
<div class="participant-avatar">${name[0].toUpperCase()}</div>
<div class="participant-name">${name}</div>
</div>
`;
});

updateRoomStatus();
}

// ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„ØºØ±ÙØ©
function updateRoomStatus() {
const status = document.getElementById('roomStatus');
status.textContent = `Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙˆÙ†: ${participants.size}/${MAX_PARTICIPANTS}`;
}

// Ø¥Ù†Ø´Ø§Ø¡ ØºØ±ÙØ© Ø¬Ø¯ÙŠØ¯Ø©
async function createRoom() {
if (!userName) {
alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù…Ùƒ Ø£ÙˆÙ„Ø§Ù‹');
return;
}

await initMedia();
roomId = Math.random().toString(36).substr(2, 9);
participants.add(userName);
updateParticipants();
showRoomCode(roomId);
setupPeerConnection(true);
}

// Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù„ØºØ±ÙØ©
async function joinRoom() {
if (!userName) {
alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù…Ùƒ Ø£ÙˆÙ„Ø§Ù‹');
return;
}

if (participants.size >= MAX_PARTICIPANTS) {
alert('Ø¹Ø°Ø±Ø§Ù‹ØŒ Ø§Ù„ØºØ±ÙØ© Ù…Ù…ØªÙ„Ø¦Ø©');
return;
}

const code = document.getElementById('roomInput').value.trim();
if(!code) {
alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙˆØ¯ Ø§Ù„ØºØ±ÙØ©');
return;
}

await initMedia();
roomId = code;
participants.add(userName);
updateParticipants();
setupPeerConnection(false);
}

// ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ÙˆØ³Ø§Ø¦Ø·
async function initMedia() {
try {
localStream = await navigator.mediaDevices.getUserMedia({ 
audio: true,
video: false
});
updateStatus('ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…Ø§ÙŠÙƒØ±ÙˆÙÙˆÙ†');
} catch (err) {
updateStatus('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù…Ø§ÙŠÙƒØ±ÙˆÙÙˆÙ†');
console.error(err);
}
}

// Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø´Ø§Ø´Ø©

async function shareScreen() {
try {
screenStream = await navigator.mediaDevices.getDisplayMedia({
video: true,
audio: true
});

// Ø¥Ø±Ø³Ø§Ù„ Ù…Ø³Ø§Ø± Ø§Ù„Ø´Ø§Ø´Ø© Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ØªØµÙ„ÙŠÙ†
Object.values(peerConnections).forEach(pc => {
screenStream.getTracks().forEach(track => {
pc.addTrack(track, screenStream);
});
});

updateStatus('Ø¬Ø§Ø±Ù Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø´Ø§Ø´Ø©');

screenStream.getVideoTracks()[0].onended = () => {
stopScreenShare();
};
} catch (err) {
console.error('Ø®Ø·Ø£ ÙÙŠ Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø´Ø§Ø´Ø©:', err);
updateStatus('ÙØ´Ù„ ÙÙŠ Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø´Ø§Ø´Ø©');
}
}

// Ø¥ÙŠÙ‚Ø§Ù Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø´Ø§Ø´Ø©
function stopScreenShare() {
if (screenStream) {
screenStream.getTracks().forEach(track => track.stop());
screenStream = null;
updateStatus('ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø´Ø§Ø´Ø©');
}
}

// Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
document.getElementById('createBtn').addEventListener('click', createRoom);
document.getElementById('joinBtn').addEventListener('click', joinRoom);
document.getElementById('micBtn').addEventListener('click', toggleMic);
document.getElementById('screenBtn').addEventListener('click', shareScreen);

// ... Ø¨Ø§Ù‚ÙŠ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø³Ø§Ø¨Ù‚ ...
</script>
</body>
</html>
