<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>MoonHelper الغرفة الكاملة</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
<style>
:root {
--primary: #7289da;
--dark: #23272a;
--light: #ffffff;
--bg: #2c2f33;
--accent: #99aab5;
}

* {
margin: 0;
padding: 0;
box-sizing: border-box;
font-family: 'Cairo', sans-serif;
}

body {
background: var(--dark);
color: var(--light);
min-height: 100vh;
}

.container {
display: grid;
grid-template-columns: 250px 1fr 300px;
height: 100vh;
}

/* Sidebar Styles */
.sidebar {
background: var(--bg);
padding: 20px;
border-right: 1px solid rgba(255,255,255,0.1);
}

.room-info {
background: rgba(255,255,255,0.1);
padding: 15px;
border-radius: 8px;
margin-bottom: 20px;
}

#roomCode {
font-size: 24px;
color: var(--primary);
font-weight: bold;
text-align: center;
}

.users-list {
margin-top: 20px;
}

.user-item {
padding: 10px;
margin: 5px 0;
background: rgba(255,255,255,0.05);
border-radius: 5px;
display: flex;
align-items: center;
gap: 10px;
}

.user-status {
width: 10px;
height: 10px;
border-radius: 50%;
background: #43b581;
}

/* Main Chat Area */
.main-area {
display: flex;
flex-direction: column;
}

.video-grid {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
gap: 20px;
padding: 20px;
background: var(--dark);
flex: 1;
}

.video-container {
position: relative;
background: var(--bg);
border-radius: 8px;
overflow: hidden;
}

video {
width: 100%;
height: 100%;
object-fit: cover;
}

.video-controls {
position: absolute;
bottom: 0;
left: 0;
right: 0;
padding: 10px;
background: rgba(0,0,0,0.5);
display: flex;
justify-content: center;
gap: 10px;
}

/* Text Chat Area */
.chat-area {
background: var(--bg);
border-left: 1px solid rgba(255,255,255,0.1);
display: flex;
flex-direction: column;
}

.messages {
flex: 1;
padding: 20px;
overflow-y: auto;
}

.message {
margin-bottom: 15px;
padding: 10px;

background: rgba(255,255,255,0.05);
border-radius: 8px;
}

.message-header {
display: flex;
justify-content: space-between;
margin-bottom: 5px;
color: var(--primary);
font-size: 0.9em;
}

.message-content {
word-break: break-word;
}

.chat-input {
padding: 20px;
background: rgba(0,0,0,0.2);
}

/* Controls & Inputs */
button {
padding: 10px 20px;
border: none;
border-radius: 5px;
background: var(--primary);
color: white;
cursor: pointer;
transition: 0.3s;
}

button:hover {
background: #5b6eae;
}

button.danger {
background: #f04747;
}

button.danger:hover {
background: #d84444;
}

input[type="text"] {
width: 100%;
padding: 10px;
border: none;
border-radius: 5px;
background: rgba(255,255,255,0.1);
color: var(--light);
margin-bottom: 10px;
}

/* Animations */
@keyframes fadeIn {
from { opacity: 0; }
to { opacity: 1; }
}

.fade-in {
animation: fadeIn 0.3s ease-in;
}

/* Welcome Screen */
.welcome-screen {
position: fixed;
top: 0;
left: 0;
right: 0;
bottom: 0;
background: var(--dark);
display: flex;
justify-content: center;
align-items: center;
z-index: 1000;
}

.welcome-box {
background: var(--bg);
padding: 30px;
border-radius: 10px;
text-align: center;
max-width: 400px;
width: 90%;
}

.hidden {
display: none;
}
</style>
</head>
<body>
<div id="welcomeScreen" class="welcome-screen">
<div class="welcome-box fade-in">
<h2>مرحباً بك في MoonHelper</h2>
<input type="text" id="username" placeholder="أدخل اسمك" class="mt-20">
<div class="mt-20">
<button onclick="createNewRoom()">إنشاء غرفة جديدة</button>
<button onclick="showJoinRoom()">الانضمام لغرفة</button>
</div>
<div id="joinRoomSection" class="hidden mt-20">
<input type="text" id="roomCodeInput" placeholder="أدخل كود الغرفة">
<button onclick="joinRoom()">انضمام</button>
</div>
</div>
</div>

<div id="mainContainer" class="container hidden">
<div class="sidebar">
<div class="room-info">
<h3>كود الغرفة</h3>
<div id="roomCode"></div>
</div>
<div class="users-list">
<h3>المتصلون</h3>
<div id="usersList"></div>
</div>
</div>

<div class="main-area">
<div class="video-grid" id="videoGrid"></div>
<div class="video-controls">
<button onclick="toggleVideo()">تشغيل/إيقاف الكاميرا</button>
<button onclick="toggleAudio()">تشغيل/إيقاف الميكروفون</button>
<button class="danger" onclick="leaveRoom()">مغادرة الغرفة</button>
</div>
</div>

<div class="chat-area">
<div class="messages" id="messages"></div>
<div class="chat-input">
<input type="text" id="messageInput" placeholder="اكتب رسالتك هنا...">
<button onclick="sendMessage()">إرسال</button>
</div>
</div>
</div>

<script>
let localStream;
let peerConnections = {};
let roomId;
let username;
let isVideoEnabled = true;
let isAudioEnabled = true;

// تهيئة RTCPeerConnection
const configuration = {
iceServers: [
{ urls: 'stun:stun.l.google.com:19302' }
]
};

// وظائف الواجهة
function showJoinRoom() {
document.getElementById('joinRoomSection').classList.remove('hidden');
}

async function createNewRoom() {
username = document.getElementById('username').value;
if (!username) {
alert('الرجاء إدخال اسمك');
return;
}
roomId = Math.random().toString(36).substr(2, 6).toUpperCase();
initializeRoom();
}

async function joinRoom() {
username = document.getElementById('username').value;
roomId = document.getElementById('roomCodeInput').value.toUpperCase();
if (!username || !roomId) {
alert('الرجاء إدخال جميع البيانات');
return;
}
initializeRoom();
}

async function initializeRoom() {
document.getElementById('welcomeScreen').classList.add('hidden');
document.getElementById('mainContainer').classList.remove('hidden');
document.getElementById('roomCode').textContent = roomId;

try {
localStream = await navigator.mediaDevices.getUserMedia({
video: true,
audio: true
});
addVideoStream('local', localStream);
setupPeerConnections();
} catch (error) {
console.error('Error accessing media devices:', error);
alert('خطأ في الوصول إلى الكاميرا أو الميكروفون');
}
}

function addVideoStream(userId, stream) {
const videoContainer = document.createElement('div');

videoContainer.className = 'video-container';
videoContainer.id = `video-${userId}`;

const video = document.createElement('video');
video.srcObject = stream;
video.autoplay = true;
if (userId === 'local') video.muted = true;

videoContainer.appendChild(video);
document.getElementById('videoGrid').appendChild(videoContainer);
}

function setupPeerConnections() {
// هنا يتم إعداد اتصالات WebRTC
// في التطبيق الحقيقي، ستحتاج إلى خادم سيغنالينغ
}

function toggleVideo() {
isVideoEnabled = !isVideoEnabled;
localStream.getVideoTracks().forEach(track => {
track.enabled = isVideoEnabled;
});
}

function toggleAudio() {
isAudioEnabled = !isAudioEnabled;
localStream.getAudioTracks().forEach(track => {
track.enabled = isAudioEnabled;
});
}

function sendMessage() {
const messageInput = document.getElementById('messageInput');
const message = messageInput.value;
if (message.trim()) {
addMessage(username, message);
messageInput.value = '';
}
}

function addMessage(user, text) {
const messagesDiv = document.getElementById('messages');
const messageDiv = document.createElement('div');
messageDiv.className = 'message fade-in';
messageDiv.innerHTML = `
<div class="message-header">
<span>${user}</span>
<span>${new Date().toLocaleTimeString()}</span>
</div>
<div class="message-content">${text}</div>
`;
messagesDiv.appendChild(messageDiv);
messagesDiv.scrollTop = messagesDiv.scrollHeight;
}

function leaveRoom() {
if (localStream) {
localStream.getTracks().forEach(track => track.stop());
}
window.location.reload();
}

// معالجة أحداث إغلاق الصفحة
window.onbeforeunload = function() {
leaveRoom();
};
</script>
</body>
</html>
