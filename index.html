
<!DOCTYPE html>
<html dir="rtl">
<head>
<meta charset="UTF-8">
<title>🌟 Galaxy Chat</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;800&display=swap" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
<style>
:root {
  --primary-dark: #0f0f1a;
  --primary-light: #1a1b2e;
  --accent: #7289da;
  --text: #ffffff;
  --success: #43b581;
  --danger: #f04747;
}

body {
  margin: 0;
  font-family: 'Cairo', sans-serif;
  background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary-light) 100%);
  color: var(--text);
  height: 100vh;
  overflow: hidden;
}

.app-container {
  display: grid;
  grid-template-columns: 280px 1fr 250px;
  height: 100vh;
}

/* Sidebar Styles */
.sidebar {
  background: rgba(255, 255, 255, 0.05);
  backdrop-filter: blur(10px);
  border-right: 1px solid rgba(255, 255, 255, 0.1);
  padding: 20px;
}

.room-card {
  background: rgba(255, 255, 255, 0.07);
  border-radius: 12px;
  padding: 15px;
  margin-bottom: 15px;
  cursor: pointer;
  transition: all 0.3s ease;
  border: 1px solid rgba(255, 255, 255, 0.1);
}

.room-card:hover {
  transform: translateY(-2px);
  background: rgba(255, 255, 255, 0.1);
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
}

/* Main Chat Area */
.chat-area {
  display: flex;
  flex-direction: column;
}

.chat-header {
  padding: 20px;
  background: rgba(255, 255, 255, 0.05);
  backdrop-filter: blur(10px);
}

.messages-container {
  flex: 1;
  overflow-y: auto;
  padding: 20px;
}

.message {
  background: rgba(255, 255, 255, 0.07);
  border-radius: 12px;
  padding: 12px;
  margin-bottom: 10px;
  max-width: 80%;
}

.message.sent {
  margin-left: auto;
  background: var(--accent);
}

/* Controls Area */
.controls-area {
  background: rgba(255, 255, 255, 0.05);
  padding: 20px;
  display: flex;
  gap: 10px;
  align-items: center;
}

.control-btn {
  width: 45px;
  height: 45px;
  border-radius: 50%;

border: none;
  background: rgba(255, 255, 255, 0.1);
  color: var(--text);
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
}

.control-btn:hover {
  background: var(--accent);
}

.control-btn.active {
  background: var(--success);
}

.control-btn.muted {
  background: var(--danger);
}

/* Participants Area */
.participants-area {
  background: rgba(255, 255, 255, 0.05);
  padding: 20px;
  border-left: 1px solid rgba(255, 255, 255, 0.1);
}

.participant {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 10px;
  border-radius: 8px;
  margin-bottom: 8px;
  background: rgba(255, 255, 255, 0.07);
}

.participant-avatar {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: var(--accent);
  display: flex;
  align-items: center;
  justify-content: center;
}

/* Custom Scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: transparent;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

/* Animations */
@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

.fade-in {
  animation: fadeIn 0.3s ease;
}

/* Modal Styles */
.modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.8);
  display: none;
  justify-content: center;
  align-items: center;
  backdrop-filter: blur(5px);
}

.modal-content {
  background: var(--primary-light);
  padding: 30px;
  border-radius: 15px;
  width: 90%;
  max-width: 500px;
  border: 1px solid rgba(255, 255, 255, 0.1);
}

/* Input Styles */
.input-group {
  display: flex;
  gap: 10px;
  margin-top: 20px;
}

.chat-input {
  flex: 1;
  padding: 12px;
  border-radius: 25px;
  border: none;
  background: rgba(255, 255, 255, 0.07);
  color: var(--text);
  font-family: 'Cairo';
}

.send-btn {
  padding: 0 20px;
  border-radius: 25px;
  border: none;
  background: var(--accent);
  color: var(--text);

cursor: pointer;
  transition: all 0.3s ease;
}

.send-btn:hover {
  transform: scale(1.05);
}
</style>
</head>
<body>
<div class="app-container">
  <!-- Sidebar -->
  <div class="sidebar">
    <h2>الغرف المتاحة</h2>
    <div id="rooms-list"></div>
    <button class="send-btn" onclick="showCreateRoomModal()">
      <i class="fas fa-plus"></i> إنشاء غرفة
    </button>
  </div>

  <!-- Main Chat Area -->
  <div class="chat-area">
    <div class="chat-header">
      <h2 id="current-room-name">اختر غرفة للانضمام</h2>
    </div>
    
    <div class="messages-container" id="messages"></div>
    
    <div class="controls-area">
      <button class="control-btn" id="mic-btn" onclick="toggleMic()">
        <i class="fas fa-microphone"></i>
      </button>
      <button class="control-btn" id="screen-btn" onclick="toggleScreenShare()">
        <i class="fas fa-desktop"></i>
      </button>
      <button class="control-btn" id="deafen-btn" onclick="toggleDeafen()">
        <i class="fas fa-headphones"></i>
      </button>
      <div class="input-group">
        <input type="text" class="chat-input" id="message-input" placeholder="اكتب رسالتك هنا...">
        <button class="send-btn" onclick="sendMessage()">
          <i class="fas fa-paper-plane"></i>
        </button>
      </div>
    </div>
  </div>

  <!-- Participants Area -->
  <div class="participants-area">
    <h2>المتصلون</h2>
    <div id="participants-list"></div>
  </div>
</div>

<!-- Create Room Modal -->
<div id="create-room-modal" class="modal">
  <div class="modal-content">
    <h2>إنشاء غرفة جديدة</h2>
    <input type="text" class="chat-input" id="room-name-input" placeholder="اسم الغرفة">
    <div class="input-group">
      <button class="send-btn" onclick="createRoom()">إنشاء</button>
      <button class="send-btn" onclick="closeModal()">إلغاء</button>
    </div>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.5.1/socket.io.js"></script>
<script>
// متغيرات عامة
let currentRoom = null;
let stream = null;
let screenStream = null;
let isMicOn = false;
let isScreenSharing = false;
let isDeafened = false;
const socket = io('https://your-server.com');

// وظائف إدارة الغرف
function showCreateRoomModal() {
  document.getElementById('create-room-modal').style.display = 'flex';
}

function closeModal() {
  document.getElementById('create-room-modal').style.display = 'none';
}

function createRoom() {
  const roomName = document.getElementById('room-name-input').value.trim();
  if (roomName) {
    socket.emit('create-room', {
      name: roomName,
      creator: socket.id
    });
    closeModal();
  }
}

function joinRoom(roomId) {
  if (currentRoom) {
    leaveRoom();
  }
  currentRoom = roomId;
  socket.emit('join-room', roomId);
  updateRoomDisplay(roomId);
}

function leaveRoom() {
  if (currentRoom) {
    stopAllStreams();
    socket.emit('leave-room', currentRoom);
    currentRoom = null;
    updateRoomDisplay(null);
  }
}

// وظائف الوسائط
async function toggleMic() {
  const micBtn = document.getElementById('mic-btn');
  
  if (!isMicOn) {
    try {
      stream = await navigator.mediaDevices.getUserMedia({ audio: true });
      socket.emit('start-audio', currentRoom);
      micBtn.classList.add('active');
      isMicOn = true;
    } catch (err) {
      console.error('خطأ في الوصول للمايك:', err);
    }
  } else {
    stopAudioStream();
    micBtn.classList.remove('active');
    isMicOn = false;
  }
}

async function toggleScreenShare() {
  const screenBtn = document.getElementById('screen-btn');
  
  if (!isScreenSharing) {
    try {
      screenStream = await navigator.mediaDevices.getDisplayMedia({
        video: true,
        audio: true
      });
      socket.emit('start-screen-share', currentRoom);
      screenBtn.classList.add('active');

isScreenSharing = true;
    } catch (err) {
      console.error('خطأ في مشاركة الشاشة:', err);
    }
  } else {
    stopScreenShare();
    screenBtn.classList.remove('active');
    isScreenSharing = false;
  }
}

function toggleDeafen() {
  const deafenBtn = document.getElementById('deafen-btn');
  isDeafened = !isDeafened;
  
  if (isDeafened) {
    deafenBtn.classList.add('muted');
    // كتم صوت جميع المشاركين
    socket.emit('toggle-deafen', { roomId: currentRoom, state: true });
  } else {
    deafenBtn.classList.remove('muted');
    // إلغاء كتم صوت المشاركين
    socket.emit('toggle-deafen', { roomId: currentRoom, state: false });
  }
}

// وظائف الرسائل
function sendMessage() {
  const input = document.getElementById('message-input');
  const message = input.value.trim();
  
  if (message && currentRoom) {
    socket.emit('chat-message', {
      room: currentRoom,
      message: message,
      sender: socket.id
    });
    input.value = '';
  }
}

// وظائف التحديث
function updateRoomDisplay(roomId) {
  const roomName = document.getElementById('current-room-name');
  if (roomId) {
    roomName.textContent = `غرفة: ${roomId}`;
  } else {
    roomName.textContent = 'اختر غرفة للانضمام';
  }
}

function updateParticipantsList(participants) {
  const list = document.getElementById('participants-list');
  list.innerHTML = '';
  
  participants.forEach(participant => {
    const div = document.createElement('div');
    div.className = 'participant fade-in';
    div.innerHTML = `
      <div class="participant-avatar">
        <i class="fas fa-user"></i>
      </div>
      <span>${participant.name}</span>
      ${participant.isSpeaking ? '<i class="fas fa-volume-up"></i>' : ''}
    `;
    list.appendChild(div);
  });
}

// وظائف المساعدة
function stopAllStreams() {
  stopAudioStream();
  stopScreenShare();
}

function stopAudioStream() {
  if (stream) {
    stream.getTracks().forEach(track => track.stop());
    stream = null;
  }
}

function stopScreenShare() {

if (screenStream) {
    screenStream.getTracks().forEach(track => track.stop());
    screenStream = null;
  }
}

// Socket.io listeners
socket.on('room-created', (roomData) => {
  const roomsList = document.getElementById('rooms-list');
  const roomDiv = document.createElement('div');
  roomDiv.className = 'room-card fade-in';
  roomDiv.innerHTML = `
    <h3>${roomData.name}</h3>
    <p>${roomData.participants} متصل</p>
  `;
  roomDiv.onclick = () => joinRoom(roomData.id);
  roomsList.appendChild(roomDiv);
});

socket.on('chat-message', (data) => {
  const messagesDiv = document.getElementById('messages');
  const messageDiv = document.createElement('div');
  messageDiv.className = `message fade-in ${data
