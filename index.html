<!DOCTYPE html>
<html dir="rtl">
<head>
<title>Moon Voice | Ø¯Ø±Ø¯Ø´Ø© ØµÙˆØªÙŠØ©</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
:root {
--primary: #6d28d9;
--secondary: #4f46e5;
--background: #f5f3ff;
--text: #1f2937;
}

* {
margin: 0;
padding: 0;
box-sizing: border-box;
font-family: 'Tajawal', sans-serif;
}

body {
background: var(--background);
height: 100vh;
display: flex;
justify-content: center;
align-items: center;
}

.app-container {
background: white;
border-radius: 20px;
box-shadow: 0 10px 30px rgba(0,0,0,0.1);
width: 90%;
max-width: 800px;
padding: 2rem;
}

.header {
text-align: center;
margin-bottom: 2rem;
}

.header h1 {
color: var(--primary);
font-size: 2.5rem;
margin-bottom: 0.5rem;
}

.header p {
color: var(--text);
opacity: 0.8;
}

.room-section {
display: flex;
flex-direction: column;
gap: 1.5rem;
margin-bottom: 2rem;
}

.room-input {
display: flex;
gap: 1rem;
}

input {
flex: 1;
padding: 1rem;
border: 2px solid #e5e7eb;
border-radius: 12px;
font-size: 1rem;
transition: border-color 0.3s;
}

input:focus {
outline: none;
border-color: var(--primary);
}

.btn {
padding: 1rem 2rem;
border: none;
border-radius: 12px;
font-weight: bold;
cursor: pointer;
transition: all 0.3s;
}

.btn-primary {
background: var(--primary);
color: white;
}

.btn-secondary {
background: var(--secondary);
color: white;
}

.btn:hover {
transform: translateY(-2px);
box-shadow: 0 5px 15px rgba(0,0,0,0.1);
}

.status {
text-align: center;
padding: 1rem;
border-radius: 12px;
background: #f3f4f6;
margin: 1rem 0;
}

.controls {
display: flex;
justify-content: center;
gap: 1rem;
margin: 2rem 0;
}

.mic-btn {
width: 70px;
height: 70px;
border-radius: 50%;
border: none;
background: var(--primary);
color: white;
font-size: 1.5rem;
cursor: pointer;
transition: all 0.3s;
box-shadow: 0 5px 15px rgba(0,0,0,0.1);
}

.mic-btn:hover {
transform: scale(1.1);
}

.mic-btn.muted {
background: #ef4444;
}

.participants {
margin-top: 2rem;
}

.participant {

display: flex;
align-items: center;
padding: 1rem;
background: #f9fafb;
border-radius: 12px;
margin-bottom: 1rem;
}

.participant-icon {
width: 40px;
height: 40px;
border-radius: 50%;
background: var(--primary);
color: white;
display: flex;
align-items: center;
justify-content: center;
margin-left: 1rem;
}

.participant-info {
flex: 1;
}

.participant-name {
font-weight: bold;
color: var(--text);
}

.participant-status {
font-size: 0.9rem;
color: #6b7280;
}

.room-code {
margin-top: 1rem;
padding: 1rem;
background: #f3f4f6;
border-radius: 12px;
display: flex;
justify-content: space-between;
align-items: center;
}

.copy-btn {
background: none;
border: none;
color: var(--primary);
cursor: pointer;
font-weight: bold;
}

@media (max-width: 640px) {
.app-container {
padding: 1rem;
}

.room-input {
flex-direction: column;
}

.btn {
width: 100%;
}
}
</style>
</head>
<body>

<div class="app-container">
<div class="header">
<h1>Moon Voice</h1>
<p>ØªØ­Ø¯Ø« Ù…Ø¹ Ø£ØµØ¯Ù‚Ø§Ø¦Ùƒ Ø¨ÙƒÙ„ Ø³Ù‡ÙˆÙ„Ø©</p>
</div>

<div class="room-section">
<div class="room-input">
<input type="text" id="roomInput" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„ØºØ±ÙØ©">
<button class="btn btn-primary" id="joinBtn">Ø§Ù†Ø¶Ù…Ø§Ù…</button>
</div>
<button class="btn btn-secondary" id="createBtn">Ø¥Ù†Ø´Ø§Ø¡ ØºØ±ÙØ© Ø¬Ø¯ÙŠØ¯Ø©</button>
</div>

<div class="status" id="statusBar">
ØºÙŠØ± Ù…ØªØµÙ„
</div>

<div class="controls">
<button class="mic-btn" id="micBtn">ğŸ¤</button>
</div>

<div class="participants" id="participantsList">
<h3>Ø§Ù„Ù…ØªØµÙ„ÙˆÙ†</h3>
<!-- Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ† Ù‡Ù†Ø§ -->
</div>

<div class="room-code" id="roomCode" style="display: none">
<span id="codeDisplay"></span>
<button class="copy-btn" onclick="copyRoomCode()">Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯</button>
</div>
</div>

<script>
let localStream;
let peerConnection;
let roomId;

// ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù…Ø§ÙŠÙƒØ±ÙˆÙÙˆÙ†
async function initAudio() {
try {
localStream = await navigator.mediaDevices.getUserMedia({ audio: true });
updateStatus('ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…Ø§ÙŠÙƒØ±ÙˆÙÙˆÙ†');
} catch (err) {
updateStatus('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù…Ø§ÙŠÙƒØ±ÙˆÙÙˆÙ†');
console.error(err);
}
}

// Ø¥Ù†Ø´Ø§Ø¡ ØºØ±ÙØ© Ø¬Ø¯ÙŠØ¯Ø©
async function createRoom() {
await initAudio();
roomId = Math.random().toString(36).substr(2, 9);
showRoomCode(roomId);
setupPeerConnection(true);
}

// Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù„ØºØ±ÙØ©
async function joinRoom() {
const code = document.getElementById('roomInput').value.trim();
if(!code) {
alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙˆØ¯ Ø§Ù„ØºØ±ÙØ©');
return;
}
await initAudio();
roomId = code;
setupPeerConnection(false);
}

// Ø¥Ø¹Ø¯Ø§Ø¯ Ø§ØªØµØ§Ù„ WebRTC
function setupPeerConnection(isHost) {
const configuration = {
iceServers: [
{ urls: 'stun:stun.l.google.com:19302' }
]
};

peerConnection = new RTCPeerConnection(configuration);

// Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„ØµÙˆØªÙŠ
localStream.getTracks().forEach(track => {
peerConnection.addTrack(track, localStream);
});

// Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„ØµÙˆØª
peerConnection.ontrack = event => {
const remoteStream = new MediaStream();
event.streams[0].getTracks().forEach(track => {
remoteStream.addTrack(track);
});
playRemoteStream(remoteStream);
};

if(isHost) {
createOffer();
}
}

// Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ø±Ø¶ Ø§Ù„Ø§ØªØµØ§Ù„
async function createOffer() {
try {
const offer = await peerConnection.createOffer();
await peerConnection.setLocalDescription(offer);
// Ù‡Ù†Ø§ ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¹Ø±Ø¶ Ù„Ù„Ø·Ø±Ù Ø§Ù„Ø¢Ø®Ø±
} catch(err) {
console.error('Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¹Ø±Ø¶:', err);
}
}

// ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª Ø§Ù„Ù‚Ø§Ø¯Ù…
function playRemoteStream(stream) {
const audio = new Audio();
audio.srcObject = stream;
audio.play();
}

// ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
function updateStatus(message) {
document.getElementById('statusBar').textContent = message;
}

// Ø¥Ø¸Ù‡Ø§Ø± ÙƒÙˆØ¯ Ø§Ù„ØºØ±ÙØ©
function showRoomCode(code) {
const roomCodeElement = document.getElementById('roomCode');
const codeDisplay = document.getElementById('codeDisplay');
roomCodeElement.style.display = 'flex';
codeDisplay.textContent = `ÙƒÙˆØ¯ Ø§Ù„ØºØ±ÙØ©: ${code}`;
}

// Ù†Ø³Ø® ÙƒÙˆØ¯ Ø§Ù„ØºØ±ÙØ©
function copyRoomCode() {
const code = document.getElementById('codeDisplay').textContent;
navigator.clipboard.writeText(code.split(': ')[1]);
alert('ØªÙ… Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯');
}

// Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ù…Ø§ÙŠÙƒØ±ÙˆÙÙˆÙ†
function toggleMic() {

const micBtn = document.getElementById('micBtn');
localStream.getAudioTracks().forEach(track => {
track.enabled = !track.enabled;
micBtn.textContent = track.enabled ? 'ğŸ¤' : 'ğŸ”‡';
micBtn.classList.toggle('muted');
});
}

// Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
document.getElementById('createBtn').addEventListener('click', createRoom);
document.getElementById('joinBtn').addEventListener('click', joinRoom);
document.getElementById('micBtn').addEventListener('click', toggleMic);
</script>
</body>
</html>
